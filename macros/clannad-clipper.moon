export script_name        = "Clannad clipper"
export script_description = "Nazaki's dumb clannad clip bullshit"
export script_version     = "0.4.2"

CLIPS = {
    false, -- edit this into a clip tag block as below if you want to insert something on the first frame too
    [[{\clip(m 319 70 l 321 70 321 1010 319 1010 m 372 70 l 374 70 374 1010 372 1010)}]],
    [[{\clip(m 316 70 l 323 70 323 1010 316 1010 m 370 70 l 375 70 375 1010 370 1010 m 424 70 l 428 70 428 1010 424 1010 m 478 70 l 481 70 481 1010 478 1010 m 532 70 l 534 70 534 1010 532 1010 m 586 70 l 587 70 587 1010 586 1010)}]],
    [[{\clip(m 312 70 l 326 70 326 1010 312 1010 m 367 70 l 378 70 378 1010 367 1010 m 421 70 l 431 70 431 1010 421 1010 m 476 70 l 483 70 483 1010 476 1010 m 530 70 l 536 70 536 1010 530 1010 m 584 70 l 588 70 588 1010 584 1010 m 638 70 l 641 70 641 1010 638 1010 m 692 70 l 694 70 694 1010 692 1010 m 746 70 l 747 70 747 1010 746 1010 m 799 70 l 800 70 800 1010 799 1010)}]],
    [[{\clip(m 307 70 l 331 70 331 1010 307 1010 m 362 70 l 383 70 383 1010 362 1010 m 417 70 l 434 70 434 1010 417 1010 m 472 70 l 486 70 486 1010 472 1010 m 527 70 l 539 70 539 1010 527 1010 m 581 70 l 591 70 591 1010 581 1010 m 636 70 l 643 70 643 1010 636 1010 m 690 70 l 695 70 695 1010 690 1010 m 744 70 l 748 70 748 1010 744 1010 m 798 70 l 801 70 801 1010 798 1010 m 852 70 l 854 70 854 1010 852 1010 m 906 70 l 907 70 907 1010 906 1010 m 959 70 l 960 70 960 1010 959 1010)}]],
    [[{\clip(m 302 70 l 336 70 336 1010 302 1010 m 357 70 l 388 70 388 1010 357 1010 m 412 70 l 439 70 439 1010 412 1010 m 467 70 l 491 70 491 1010 467 1010 m 522 70 l 543 70 543 1010 522 1010 m 577 70 l 595 70 595 1010 577 1010 m 632 70 l 647 70 647 1010 632 1010 m 686 70 l 699 70 699 1010 686 1010 m 741 70 l 751 70 751 1010 741 1010 m 795 70 l 803 70 803 1010 795 1010 m 850 70 l 856 70 856 1010 850 1010 m 904 70 l 908 70 908 1010 904 1010 m 958 70 l 961 70 961 1010 958 1010 m 1012 70 l 1014 70 1014 1010 1012 1010 m 1066 70 l 1067 70 1067 1010 1066 1010 m 1119 70 l 1120 70 1120 1010 1119 1010)}]],
    [[{\clip(m 296 70 l 342 70 342 1010 296 1010 m 351 70 l 394 70 394 1010 351 1010 m 406 70 l 445 70 445 1010 406 1010 m 461 70 l 496 70 496 1010 461 1010 m 517 70 l 548 70 548 1010 517 1010 m 572 70 l 599 70 599 1010 572 1010 m 627 70 l 651 70 651 1010 627 1010 m 682 70 l 703 70 703 1010 682 1010 m 737 70 l 755 70 755 1010 737 1010 m 792 70 l 807 70 807 1010 792 1010 m 846 70 l 859 70 859 1010 846 1010 m 901 70 l 911 70 911 1010 901 1010 m 955 70 l 963 70 963 1010 955 1010 m 1010 70 l 1016 70 1016 1010 1010 1010 m 1064 70 l 1068 70 1068 1010 1064 1010 m 1118 70 l 1121 70 1121 1010 1118 1010 m 1172 70 l 1174 70 1174 1010 1172 1010 m 1226 70 l 1227 70 1227 1010 1226 1010 m 1279 70 l 1280 70 1280 1010 1279 1010)}]],
    [[{\clip(m 308 70 l 399 70 399 1010 308 1010 m 401 70 l 451 70 451 1010 401 1010 m 456 70 l 502 70 502 1010 456 1010 m 511 70 l 554 70 554 1010 511 1010 m 566 70 l 605 70 605 1010 566 1010 m 621 70 l 657 70 657 1010 621 1010 m 677 70 l 708 70 708 1010 677 1010 m 732 70 l 760 70 760 1010 732 1010 m 787 70 l 811 70 811 1010 787 1010 m 842 70 l 863 70 863 1010 842 1010 m 897 70 l 915 70 915 1010 897 1010 m 951 70 l 967 70 967 1010 951 1010 m 1006 70 l 1019 70 1019 1010 1006 1010 m 1061 70 l 1071 70 1071 1010 1061 1010 m 1115 70 l 1123 70 1123 1010 1115 1010 m 1170 70 l 1176 70 1176 1010 1170 1010 m 1224 70 l 1228 70 1228 1010 1224 1010 m 1278 70 l 1281 70 1281 1010 1278 1010 m 1332 70 l 1334 70 1334 1010 1332 1010 m 1386 70 l 1387 70 1387 1010 1386 1010)}]],
    [[{\clip(m 308 70 l 559 70 559 1010 308 1010 m 561 70 l 611 70 611 1010 561 1010 m 615 70 l 663 70 663 1010 615 1010 m 671 70 l 714 70 714 1010 671 1010 m 726 70 l 766 70 766 1010 726 1010 m 781 70 l 817 70 817 1010 781 1010 m 836 70 l 868 70 868 1010 836 1010 m 892 70 l 920 70 920 1010 892 1010 m 947 70 l 972 70 972 1010 947 1010 m 1002 70 l 1023 70 1023 1010 1002 1010 m 1057 70 l 1075 70 1075 1010 1057 1010 m 1111 70 l 1127 70 1127 1010 1111 1010 m 1166 70 l 1179 70 1179 1010 1166 1010 m 1221 70 l 1231 70 1231 1010 1221 1010 m 1275 70 l 1283 70 1283 1010 1275 1010 m 1330 70 l 1336 70 1336 1010 1330 1010 m 1384 70 l 1388 70 1388 1010 1384 1010 m 1438 70 l 1441 70 1441 1010 1438 1010 m 1492 70 l 1494 70 1494 1010 1492 1010 m 1546 70 l 1547 70 1547 1010 1546 1010)}]],
    [[{\clip(m 308 70 l 719 70 719 1010 308 1010 m 721 70 l 771 70 771 1010 721 1010 m 775 70 l 823 70 823 1010 775 1010 m 830 70 l 874 70 874 1010 830 1010 m 886 70 l 925 70 925 1010 886 1010 m 941 70 l 977 70 977 1010 941 1010 m 996 70 l 1028 70 1028 1010 996 1010 m 1051 70 l 1080 70 1080 1010 1051 1010 m 1107 70 l 1131 70 1131 1010 1107 1010 m 1162 70 l 1183 70 1183 1010 1162 1010 m 1216 70 l 1235 70 1235 1010 1216 1010 m 1271 70 l 1287 70 1287 1010 1271 1010 m 1326 70 l 1339 70 1339 1010 1326 1010 m 1381 70 l 1391 70 1391 1010 1381 1010 m 1435 70 l 1444 70 1444 1010 1435 1010 m 1490 70 l 1496 70 1496 1010 1490 1010 m 1544 70 l 1548 70 1548 1010 1544 1010 m 1598 70 l 1601 70 1601 1010 1598 1010)}]],
    [[{\clip(m 308 70 l 879 70 879 1010 308 1010 m 881 70 l 932 70 932 1010 881 1010 m 935 70 l 983 70 983 1010 935 1010 m 990 70 l 1034 70 1034 1010 990 1010 m 1046 70 l 1086 70 1086 1010 1046 1010 m 1101 70 l 1137 70 1137 1010 1101 1010 m 1156 70 l 1188 70 1188 1010 1156 1010 m 1211 70 l 1240 70 1240 1010 1211 1010 m 1267 70 l 1291 70 1291 1010 1267 1010 m 1321 70 l 1343 70 1343 1010 1321 1010 m 1377 70 l 1395 70 1395 1010 1377 1010 m 1431 70 l 1447 70 1447 1010 1431 1010 m 1486 70 l 1499 70 1499 1010 1486 1010 m 1541 70 l 1551 70 1551 1100 1541 1100 m 1596 70 l 1603 70 1603 1010 1596 1010)}]],
    [[{\clip(m 308 70 l 1092 70 1092 1010 308 1010 m 1095 70 l 1144 70 1144 1010 1095 1010 m 1150 70 l 1194 70 1194 1010 1150 1010 m 1206 70 l 1246 70 1246 1010 1206 1010 m 1261 70 l 1297 70 1297 1010 1261 1010 m 1316 70 l 1349 70 1349 1010 1316 1010 m 1371 70 l 1400 70 1400 1010 1371 1010 m 1426 70 l 1452 70 1452 1010 1426 1010 m 1481 70 l 1503 70 1503 1010 1481 1010 m 1537 70 l 1555 70 1555 1010 1537 1010 m 1592 70 l 1607 70 1607 1010 1592 1010)}]],
    [[{\clip(m 308 70 l 1252 70 1252 1010 308 1010 m 1255 70 l 1303 70 1303 1010 1255 1010 m 1310 70 l 1354 70 1354 1010 1310 1010 m 1365 70 l 1406 70 1406 1010 1365 1010 m 1421 70 l 1457 70 1457 1010 1421 1010 m 1476 70 l 1509 70 1509 1010 1476 1010 m 1531 70 l 1560 70 1560 1010 1531 1010 m 1586 70 l 1611 70 1611 1010 1586 1010)}]],
    [[{\clip(m 308 70 l 1412 70 1412 1010 308 1010 m 1415 70 l 1463 70 1463 1010 1415 1010 m 1470 70 l 1515 70 1515 1010 1470 1010 m 1525 70 l 1566 70 1566 1010 1525 1010 m 1581 70 l 1617 70 1617 1010 1581 1010)}]],
    [[{\clip(m 308 70 l 1572 70 1572 1010 308 1010 m 1575 70 l 1623 70 1623 1010 1575 1010)}]],
}

msff = aegisub.ms_from_frame
ffms = aegisub.frame_from_ms

main = (sub, sel) ->
    -- for each selected line
    --   fbf first 15 frames
    --   leave out first, apply clips to rest
    --   leave end otherwise untouched

    for i = #sel, 1, -1
        line = sub[sel[i]]
        text = line.text
        start_f = ffms line.start_time

        -- write out end first
        line.start_time = msff start_f + 15
        sub[sel[i]] = line

        -- then do clips
        for j = #CLIPS, 1, -1
            clip = CLIPS[j]
            unless clip continue --skip blank

            line.start_time = msff start_f + j - 1
            line.end_time = msff start_f + j
            line.text = clip .. text

            sub[-sel[i]] = line

aegisub.register_macro script_name, script_description, main
